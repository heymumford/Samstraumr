<?xml version="1.0" encoding="UTF-8"?>
<!--
Copyright (c) 2025 Eric C. Mumford (@heymumford)

This software was developed with analytical assistance from AI tools 
including Claude 3.7 Sonnet, Claude Code, and Google Gemini Deep Research,
which were used as paid services. All intellectual property rights 
remain exclusively with the copyright holder listed above.

Licensed under the Mozilla Public License 2.0
-->
<project xmlns="http://maven.apache.org/POM/4.0.0" 
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
  <modelVersion>4.0.0</modelVersion>

  <groupId>org.s8r</groupId>
  <artifactId>samstraumr-modules</artifactId>
  <version>2.4.2</version>
  <name>Samstraumr Modules</name>
  <packaging>pom</packaging>

  <modules>
    <module>samstraumr-core</module>
  </modules>

  <properties>
    <version.file.path>${project.basedir}/version.properties</version.file.path>
    <samstraumr.version>2.4.2</samstraumr.version>
    <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
    <maven.compiler.source>21</maven.compiler.source>
    <maven.compiler.target>21</maven.compiler.target>
    <test.tags>@ATL</test.tags>
    <all.test.tags>@ATL</all.test.tags>
    <maven.compiler.plugin.version>3.12.1</maven.compiler.plugin.version>
    <maven.surefire.plugin.version>3.2.5</maven.surefire.plugin.version>
    <maven.resources.plugin.version>3.3.1</maven.resources.plugin.version>
    <spotless.plugin.version>2.40.0</spotless.plugin.version>
    <spotless.google.format.version>1.19.2</spotless.google.format.version>
    <checkstyle.plugin.version>3.3.1</checkstyle.plugin.version>
    <checkstyle.version>10.14.0</checkstyle.version>
    <spotbugs.plugin.version>4.8.3.0</spotbugs.plugin.version>
    <jacoco.plugin.version>0.8.11</jacoco.plugin.version>
    <jacoco.line.coverage>0.75</jacoco.line.coverage>
    <jacoco.branch.coverage>0.75</jacoco.branch.coverage>
    <maven.site.plugin.version>4.0.0-M13</maven.site.plugin.version>
    <maven.project.info.reports.plugin.version>3.5.0</maven.project.info.reports.plugin.version>
    <dependency-check.version>9.0.7</dependency-check.version>
  </properties>

  <build>
    <pluginManagement>
      <plugins>
        <plugin>
          <groupId>org.apache.maven.plugins</groupId>
          <artifactId>maven-compiler-plugin</artifactId>
          <version>${maven.compiler.plugin.version}</version>
          <configuration>
            <source>${maven.compiler.source}</source>
            <target>${maven.compiler.target}</target>
            <encoding>${project.build.sourceEncoding}</encoding>
          </configuration>
        </plugin>
        
        <plugin>
          <groupId>org.apache.maven.plugins</groupId>
          <artifactId>maven-surefire-plugin</artifactId>
          <version>${maven.surefire.plugin.version}</version>
        </plugin>
        
        <plugin>
          <groupId>org.apache.maven.plugins</groupId>
          <artifactId>maven-resources-plugin</artifactId>
          <version>${maven.resources.plugin.version}</version>
          <configuration>
            <encoding>${project.build.sourceEncoding}</encoding>
          </configuration>
        </plugin>
      </plugins>
    </pluginManagement>
  </build>
  
  <profiles>
    <profile>
      <id>tests</id>
      <properties>
        <cucumber.filter.tags>${test.tags}</cucumber.filter.tags>
        <skipTests>false</skipTests>
        <maven.test.skip>false</maven.test.skip>
      </properties>
    </profile>
    
    <profile>
      <id>tdd-development</id>
      <activation>
        <activeByDefault>true</activeByDefault>
      </activation>
      <properties>
        <jacoco.line.coverage>0.0</jacoco.line.coverage>
        <jacoco.branch.coverage>0.0</jacoco.branch.coverage>
        
        <skipTests>false</skipTests>
        <maven.test.skip>false</maven.test.skip>
        <testFailureIgnore>false</testFailureIgnore>
      </properties>
    </profile>
    
    <profile>
      <id>ci-pipeline</id>
      <properties>
        <skipTests>false</skipTests>
        <maven.test.skip>false</maven.test.skip>
        <testFailureIgnore>false</testFailureIgnore>
      </properties>
      <build>
        <plugins>
          <!-- OWASP Dependency Check -->
          <plugin>
            <groupId>org.owasp</groupId>
            <artifactId>dependency-check-maven</artifactId>
            <version>${dependency-check.version}</version>
            <configuration>
              <!-- Run in parallel when possible -->
              <parallelAnalysis>true</parallelAnalysis>
              <!-- Only show vulnerabilities with at least medium severity -->
              <failBuildOnCVSS>7</failBuildOnCVSS>
              <!-- Output formats -->
              <formats>
                <format>HTML</format>
                <format>JSON</format>
              </formats>
              <!-- Suppression file for false positives -->
              <suppressionFile>${project.basedir}/owasp-suppressions.xml</suppressionFile>
              <!-- Better handling of API rate limiting -->
              <nvdApiWait>2000</nvdApiWait>
              <nvdApiMaxRetries>2</nvdApiMaxRetries>
              <skipOnError>false</skipOnError>
              <ossindexAnalyzerEnabled>false</ossindexAnalyzerEnabled>
              <retireJsAnalyzerEnabled>true</retireJsAnalyzerEnabled>
              <nodeAuditAnalyzerEnabled>false</nodeAuditAnalyzerEnabled>
              <!-- Update NVD database only if older than 24 hours -->
              <autoUpdate>true</autoUpdate>
              <cveValidForHours>24</cveValidForHours>
            </configuration>
            <!-- Don't automatically run during standard build -->
            <!-- Will only be executed when ci-pipeline profile is activated -->
            <executions>
              <execution>
                <goals>
                  <goal>check</goal>
                </goals>
              </execution>
            </executions>
          </plugin>
        </plugins>
      </build>
    </profile>
    
    <profile>
      <id>ci-pipeline-nonblocking</id>
      <build>
        <plugins>
          <!-- OWASP Dependency Check in non-blocking mode -->
          <plugin>
            <groupId>org.owasp</groupId>
            <artifactId>dependency-check-maven</artifactId>
            <version>${dependency-check.version}</version>
            <configuration>
              <!-- Run in parallel when possible -->
              <parallelAnalysis>true</parallelAnalysis>
              <!-- Report only, don't fail the build -->
              <failBuildOnCVSS>11</failBuildOnCVSS>
              <!-- Output formats -->
              <formats>
                <format>HTML</format>
                <format>JSON</format>
              </formats>
              <!-- Suppression file for false positives -->
              <suppressionFile>${project.basedir}/owasp-suppressions.xml</suppressionFile>
              <!-- Better offline support -->
              <nvdApiWait>2000</nvdApiWait>
              <nvdApiMaxRetries>1</nvdApiMaxRetries>
              <skipOnError>true</skipOnError>
              <ossindexAnalyzerEnabled>false</ossindexAnalyzerEnabled>
              <retireJsAnalyzerEnabled>true</retireJsAnalyzerEnabled>
              <nodeAuditAnalyzerEnabled>false</nodeAuditAnalyzerEnabled>
              <!-- Update NVD database only if older than 7 days for dev environments -->
              <autoUpdate>true</autoUpdate>
              <cveValidForHours>168</cveValidForHours>
            </configuration>
            <!-- Don't automatically run during standard build -->
            <!-- Will only be executed when ci-pipeline-nonblocking profile is activated -->
            <executions>
              <execution>
                <goals>
                  <goal>check</goal>
                </goals>
              </execution>
            </executions>
          </plugin>
        </plugins>
      </build>
    </profile>
  </profiles>
</project>