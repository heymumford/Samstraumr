#!/bin/bash
# Samstraumr Git hook: prepare-commit-msg
# Purpose: Prevents Claude Code and other AI tool signatures from appearing in commits
# Installation: Copy to .git/hooks/prepare-commit-msg and make executable (chmod +x)

# Read the commit message
COMMIT_MSG_FILE="$1"
COMMIT_SOURCE="$2"

# Only process if not a merge commit message
if [ "$COMMIT_SOURCE" != "merge" ]; then
  # Remove Claude signature lines from the message
  sed -i '/Generated with \[Claude Code\]/d' "$COMMIT_MSG_FILE"
  sed -i '/Co-Authored-By: Claude/d' "$COMMIT_MSG_FILE"
  # Generic patterns for other AI assistants
  sed -i '/AI-assisted/d' "$COMMIT_MSG_FILE"
  sed -i '/Generated by/d' "$COMMIT_MSG_FILE"
  sed -i '/Co-authored-by:/d' "$COMMIT_MSG_FILE"
  
  # Clean up any excess blank lines that might be left
  sed -i -e :a -e '/^\n*$/{$d;N;ba' -e '}' "$COMMIT_MSG_FILE"
fi